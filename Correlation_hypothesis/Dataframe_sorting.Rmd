---
title: "Correlation_statisitcal_tests"
author: "Paula"
date: "2023-06-20"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Sorting of Data Frames

This markdown is mainly used to normalize and sort data into data frames most useful for correlation tests and other test.

## 1. Load the packages and data frames

```{r}
#install and load needed Packages 
install.packages("readxl")
install.packages("tidyr")
library(readxl)
library(tidyr)

#load population data 
popu_06 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2006_population.xlsx")
popu_07 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2007_population.xlsx")
popu_08 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2008_population.xlsx")
popu_09 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2009_population.xlsx")
popu_10 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2010_population.xlsx")
popu_11 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2011_population.xlsx")
popu_12_21 <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\2012-2021-population-sector_01_11102_EN_.xlsx")

#load the humidity data 

T.huss.mon = read_excel("../era5_data_2006_2020_thailand_monmean.xlsx", sheet="era5_huss_2006_2020_thailand_mo")

#load the dengue data 
dengue <- read.csv("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\dengue_data\\dengue_data_com2.csv")

#load population density 
popu_density <- read_excel("C:\\Users\\paula\\Documents\\Uni Heidelberg\\4. Semester\\Bioinformatik\\github\\topic04_team01\\population_data\\population_density.xlsx", sheet="population density")
```

## 2. Creating a normalized dengue Data frame, without removing the NA's

The humidity data is not sorted alphabetically and contains columns that aren't needed, let's remove them and sort the data frame.

```{r}
#the dengue data provinces have different names than the ones in the dengue dataframe and are therefore sorted differently, let's make sure they match 
##we need a copy of the humidity dataframe because some poeple in the repository are working with the initial data frame 
T.huss.mon1 <- data.frame(T.huss.mon)

##which names don't match up 
different_names <- dengue$Reporting.areas[which(!dengue$Reporting.areas %in% T.huss.mon1$ADM1_EN)]
print(different_names)

##replace the names in the humidity data with the correct province names from the dengue data 
T.huss.mon1$ADM1_EN[T.huss.mon1$ADM1_EN == "Bueng Kan"] <- "Bungkan"
T.huss.mon1$ADM1_EN[T.huss.mon1$ADM1_EN == "Phra Nakhon Si Ayutthaya"] <- "P.Nakhon S.Ayutthaya"

#sort the new provinces alphabetically
T.huss.mon1 <- T.huss.mon1[order(T.huss.mon1$ADM1_EN), ]

#and save a copy so other members of the repository can work with it too
filePath = paste(dirname(getwd()), "geo_data", "T.huss.mon_correct_provinces.csv",sep = "/")
write.csv(T.huss.mon1, filePath)

#remove columns that aren't needed for further analysis
i.remove <- which(colnames(T.huss.mon) %in% c("Number","Longitude", "Latitude"))
T.huss.mon1 <- T.huss.mon[,-i.remove]
```

The population data is stored in different excel files and to work with them, we need them in one single data frame and save them into a single file.

```{r}
#bind the coloumns in the different excel files together in one new dataframe
popu_06_20 <- cbind(popu_06, "2007" = popu_07$`Total population`, "2008" = popu_08$`Total population`, "2009" = popu_09$`Total population`, "2010" = popu_10$`Total population`, "2011" =  popu_11$`Total population`, popu_12_21[,3:12])

#rename the coloumn that contains the population data from 2006 to "2006"
names(popu_06_20)[names(popu_06_20) == "Total population"] <- "2006"

#to avoid having to run the entire code to get this version of the dataframe, let's save this as a csv file as well
filePath = paste(dirname(getwd()), "population_data", "population_06_20.csv",sep = "/")
write.csv(popu_06_20, filePath)

```

To avoid the correlation being distorted by the differences in population, it is necessary to normalize the dengue data to cases per 100'000 people.
To do this the cases in each year and province are divided by the population of the respective province and respective year and then multiplied by 100'000.

```{r}
#create a new dataframe, where the normalized data will be saved, we can use a copy of the non normalized data frame
dengue_norm = data.frame(dengue)

# loops over all years in population dataframe
for(i in 3 : ncol(popu_06_20)) {
  # stores yearly population in local variable
  yearly_pop = popu_06_20[,i]
  # loops over total and monthly columns of each year
  for(j in 0:12) {
    # calculates index of corresponding monthly cases
    # cases start at column index 3
    # every year is displayed over 13 columns, thus every year cursor jumps by 13 columns (i-3)*13
    # as years each are displayed in 13 columns, each month the cursor jumps over by 1
    case_index = 3 + (i-3)*13 + j
    
    selected_cases = dengue[,case_index]
    normalized_cases = selected_cases / yearly_pop * 100000
    
    dengue_norm[,case_index] = normalized_cases
  }
}

#let's save the normalized data in the repository 
filePath = paste(dirname(getwd()), "dengue_data", "dengue_norm.csv",sep = "/")
write.csv(dengue_norm, filePath)
```

## 3. Normalized Dengue Dataframe in the longformat

For correlation tests, it is easier to work with dataframes in the longformat.

```{r}

#stack the months of each year atop of each other 
#2006
stacked_06 <- c(dengue_norm$X2006.01, dengue_norm$X2006.02, dengue_norm$X2006.03, dengue_norm$X2006.04, dengue_norm$X2006.05, dengue_norm$X2006.06, dengue_norm$X2006.07, dengue_norm$X2006.08, dengue_norm$X2006.09, dengue_norm$X2006.10, dengue_norm$X2006.11, dengue_norm$X2006.12)

#2007
stacked_07 <- c(dengue_norm$X2007.01, dengue_norm$X2007.02, dengue_norm$X2007.03, dengue_norm$X2007.04, dengue_norm$X2007.05, dengue_norm$X2007.06, dengue_norm$X2007.07, dengue_norm$X2007.08, dengue_norm$X2007.09, dengue_norm$X2007.10, dengue_norm$X2007.11, dengue_norm$X2007.12)

#2008
stacked_08 <- c(dengue_norm$X2008.01, dengue_norm$X2008.02, dengue_norm$X2008.03, dengue_norm$X2008.04, dengue_norm$X2008.05, dengue_norm$X2008.06, dengue_norm$X2008.07, dengue_norm$X2008.08, dengue_norm$X2008.09, dengue_norm$X2008.10, dengue_norm$X2008.11, dengue_norm$X2008.12)

#2009
stacked_09 <- c(dengue_norm$X2009.01, dengue_norm$X2009.02, dengue_norm$X2009.03, dengue_norm$X2009.04, dengue_norm$X2009.05, dengue_norm$X2009.06, dengue_norm$X2009.07, dengue_norm$X2009.08, dengue_norm$X2009.09, dengue_norm$X2009.10, dengue_norm$X2009.11, dengue_norm$X2009.12)

#2010
stacked_10 <- c(dengue_norm$X2010.01, dengue_norm$X2010.02, dengue_norm$X2010.03, dengue_norm$X2010.04, dengue_norm$X2010.05, dengue_norm$X2010.06, dengue_norm$X2010.07, dengue_norm$X2010.08, dengue_norm$X2010.09, dengue_norm$X2010.10, dengue_norm$X2010.11, dengue_norm$X2010.12)

#2011
stacked_11 <- c(dengue_norm$X2011.01, dengue_norm$X2011.02, dengue_norm$X2011.03, dengue_norm$X2011.04, dengue_norm$X2011.05, dengue_norm$X2011.06, dengue_norm$X2011.07, dengue_norm$X2011.08, dengue_norm$X2011.09, dengue_norm$X2011.10, dengue_norm$X2011.11, dengue_norm$X2011.12)

#2012
stacked_12 <- c(dengue_norm$X2012.01, dengue_norm$X2012.02, dengue_norm$X2012.03, dengue_norm$X2012.04, dengue_norm$X2012.05, dengue_norm$X2012.06, dengue_norm$X2012.07, dengue_norm$X2012.08, dengue_norm$X2012.09, dengue_norm$X2012.10, dengue_norm$X2012.11, dengue_norm$X2012.12)

#2013
stacked_13 <- c(dengue_norm$X2013.01, dengue_norm$X2013.02, dengue_norm$X2013.03, dengue_norm$X2013.04, dengue_norm$X2013.05, dengue_norm$X2013.06, dengue_norm$X2013.07, dengue_norm$X2013.08, dengue_norm$X2013.09, dengue_norm$X2013.10, dengue_norm$X2013.11, dengue_norm$X2013.12)

#2014
stacked_14 <- c(dengue_norm$X2014.01, dengue_norm$X2014.02, dengue_norm$X2014.03, dengue_norm$X2014.04, dengue_norm$X2014.05, dengue_norm$X2014.06, dengue_norm$X2014.07, dengue_norm$X2014.08, dengue_norm$X2014.09, dengue_norm$X2014.10, dengue_norm$X2014.11, dengue_norm$X2014.12)

#2015
stacked_15 <- c(dengue_norm$X2015.01, dengue_norm$X2015.02, dengue_norm$X2015.03, dengue_norm$X2015.04, dengue_norm$X2015.05, dengue_norm$X2015.06, dengue_norm$X2015.07, dengue_norm$X2015.08, dengue_norm$X2015.09, dengue_norm$X2015.10, dengue_norm$X2015.11, dengue_norm$X2015.12)

#2016
stacked_16 <- c(dengue_norm$X2016.01, dengue_norm$X2016.02, dengue_norm$X2016.03, dengue_norm$X2016.04, dengue_norm$X2016.05, dengue_norm$X2016.06, dengue_norm$X2016.07, dengue_norm$X2016.08, dengue_norm$X2016.09, dengue_norm$X2016.10, dengue_norm$X2016.11, dengue_norm$X2016.12)

#2017
stacked_17 <- c(dengue_norm$X2017.01, dengue_norm$X2017.02, dengue_norm$X2017.03, dengue_norm$X2017.04, dengue_norm$X2017.05, dengue_norm$X2017.06, dengue_norm$X2017.07, dengue_norm$X2017.08, dengue_norm$X2017.09, dengue_norm$X2017.10, dengue_norm$X2017.11, dengue_norm$X2017.12)

#2018
stacked_18 <- c(dengue_norm$X2018.01, dengue_norm$X2018.02, dengue_norm$X2018.03, dengue_norm$X2018.04, dengue_norm$X2018.05, dengue_norm$X2018.06, dengue_norm$X2018.07, dengue_norm$X2018.08, dengue_norm$X2018.09, dengue_norm$X2018.10, dengue_norm$X2018.11, dengue_norm$X2018.12)

#2019
stacked_19 <- c(dengue_norm$X2019.01, dengue_norm$X2019.02, dengue_norm$X2019.03, dengue_norm$X2019.04, dengue_norm$X2019.05, dengue_norm$X2019.06, dengue_norm$X2019.07, dengue_norm$X2019.08, dengue_norm$X2019.09, dengue_norm$X2019.10, dengue_norm$X2019.11, dengue_norm$X2019.12)

#2020
stacked_20 <- c(dengue_norm$X2020.01, dengue_norm$X2020.02, dengue_norm$X2020.03, dengue_norm$X2020.04, dengue_norm$X2020.05, dengue_norm$X2020.06, dengue_norm$X2020.07, dengue_norm$X2020.08, dengue_norm$X2020.09, dengue_norm$X2020.10, dengue_norm$X2020.11, dengue_norm$X2020.12)

#now stack the years on top of each other 
stacked_years <- c(stacked_06, stacked_07, stacked_08, stacked_09, stacked_10, stacked_11, stacked_12, stacked_13, stacked_14, stacked_15, stacked_16, stacked_17, stacked_18, stacked_19, stacked_20)

#make it into a dataframe 
dengue_longformat <- data.frame(stacked_years)

#the years are missing 
years <- rep(2006:2020, each = 12 * 77)  # Repeat each year 12 months * 77 provinces times

#the months need to be added as well
months <- rep(rep(c("01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"), each = 77), times = 15)  # Repeat each season 77 provinces * 15 years times

# Repeat the province names to match the length of the combined_dataframe
Provinces <- dengue_norm$Reporting.areas
province_names <- rep(Provinces, length.out = nrow(dengue_longformat))

# Add the Provinces, the years and seasons to the dataframe
dengue_longformat$Year <- years
dengue_longformat$months <- months
dengue_longformat$Province <- province_names

#let's just order the columns 
dengue_longformat <- data.frame(Province = province_names, Year = years, Month = months, Dengue = stacked_years)
```

To be able to use this data frame for correlation testing, the humidity data needs to be added as well

```{r}
#we need to stack the humidity data in the same year 
#2006
stackedH_06 <- c(T.huss.mon1$"2006.01.", T.huss.mon1$"2006.02.", T.huss.mon1$"2006.03.", T.huss.mon1$"2006.04.", T.huss.mon1$"2006.05.", T.huss.mon1$"2006.06.", T.huss.mon1$"2006.07.", T.huss.mon1$"2006.08.", T.huss.mon1$"2006.09.", T.huss.mon1$"2006.10.", T.huss.mon1$"2006.11.", T.huss.mon1$"2006.12.")

#2007
stackedH_07 <- c(T.huss.mon1$"2007.01.", T.huss.mon1$"2007.02.", T.huss.mon1$"2007.03.", T.huss.mon1$"2007.04.", T.huss.mon1$"2007.05.", T.huss.mon1$"2007.06.", T.huss.mon1$"2007.07.", T.huss.mon1$"2007.08.", T.huss.mon1$"2007.09.", T.huss.mon1$"2007.10.", T.huss.mon1$"2007.11.", T.huss.mon1$"2007.12.")

#2008
stackedH_08 <- c(T.huss.mon1$"2008.01.", T.huss.mon1$"2008.02.", T.huss.mon1$"2008.03.", T.huss.mon1$"2008.04.", T.huss.mon1$"2008.05.", T.huss.mon1$"2008.06.", T.huss.mon1$"2008.07.", T.huss.mon1$"2008.08.", T.huss.mon1$"2008.09.", T.huss.mon1$"2008.10.", T.huss.mon1$"2008.11.", T.huss.mon1$"2008.12.")

#2009
stackedH_09 <- c(T.huss.mon1$"2009.01.", T.huss.mon1$"2009.02.", T.huss.mon1$"2009.03.", T.huss.mon1$"2009.04.", T.huss.mon1$"2009.05.", T.huss.mon1$"2009.06.", T.huss.mon1$"2009.07.", T.huss.mon1$"2009.08.", T.huss.mon1$"2009.09.", T.huss.mon1$"2009.10.", T.huss.mon1$"2009.11.", T.huss.mon1$"2009.12.")

#2010
stackedH_10 <- c(T.huss.mon1$"2010.01.", T.huss.mon1$"2010.02.", T.huss.mon1$"2010.03.", T.huss.mon1$"2010.04.", T.huss.mon1$"2010.05.", T.huss.mon1$"2010.06.", T.huss.mon1$"2010.07.", T.huss.mon1$"2010.08.", T.huss.mon1$"2010.09.", T.huss.mon1$"2010.10.", T.huss.mon1$"2010.11.", T.huss.mon1$"2010.12.")

#2011
stackedH_11 <- c(T.huss.mon1$"2011.01.", T.huss.mon1$"2011.02.", T.huss.mon1$"2011.03.", T.huss.mon1$"2011.04.", T.huss.mon1$"2011.05.", T.huss.mon1$"2011.06.", T.huss.mon1$"2011.07.", T.huss.mon1$"2011.08.", T.huss.mon1$"2011.09.", T.huss.mon1$"2011.10.", T.huss.mon1$"2011.11.", T.huss.mon1$"2011.12.")

#2012
stackedH_12 <- c(T.huss.mon1$"2012.01.", T.huss.mon1$"2012.02.", T.huss.mon1$"2012.03.", T.huss.mon1$"2012.04.", T.huss.mon1$"2012.05.", T.huss.mon1$"2012.06.", T.huss.mon1$"2012.07.", T.huss.mon1$"2012.08.", T.huss.mon1$"2012.09.", T.huss.mon1$"2012.10.", T.huss.mon1$"2012.11.", T.huss.mon1$"2012.12.")

#2013
stackedH_13 <- c(T.huss.mon1$"2013.01.", T.huss.mon1$"2013.02.", T.huss.mon1$"2013.03.", T.huss.mon1$"2013.04.", T.huss.mon1$"2013.05.", T.huss.mon1$"2013.06.", T.huss.mon1$"2013.07.", T.huss.mon1$"2013.08.", T.huss.mon1$"2013.09.", T.huss.mon1$"2013.10.", T.huss.mon1$"2013.11.", T.huss.mon1$"2013.12.")

#2014
stackedH_14 <- c(T.huss.mon1$"2014.01.", T.huss.mon1$"2014.02.", T.huss.mon1$"2014.03.", T.huss.mon1$"2014.04.", T.huss.mon1$"2014.05.", T.huss.mon1$"2014.06.", T.huss.mon1$"2014.07.", T.huss.mon1$"2014.08.", T.huss.mon1$"2014.09.", T.huss.mon1$"2014.10.", T.huss.mon1$"2014.11.", T.huss.mon1$"2014.12.")

#2015
stackedH_15 <- c(T.huss.mon1$"2015.01.", T.huss.mon1$"2015.02.", T.huss.mon1$"2015.03.", T.huss.mon1$"2015.04.", T.huss.mon1$"2015.05.", T.huss.mon1$"2015.06.", T.huss.mon1$"2015.07.", T.huss.mon1$"2015.08.", T.huss.mon1$"2015.09.", T.huss.mon1$"2015.10.", T.huss.mon1$"2015.11.", T.huss.mon1$"2015.12.")

#2016
stackedH_16 <- c(T.huss.mon1$"2016.01.", T.huss.mon1$"2016.02.", T.huss.mon1$"2016.03.", T.huss.mon1$"2016.04.", T.huss.mon1$"2016.05.", T.huss.mon1$"2016.06.", T.huss.mon1$"2016.07.", T.huss.mon1$"2016.08.", T.huss.mon1$"2016.09.", T.huss.mon1$"2016.10.", T.huss.mon1$"2016.11.", T.huss.mon1$"2016.12.")

#2017
stackedH_17 <- c(T.huss.mon1$"2017.01.", T.huss.mon1$"2017.02.", T.huss.mon1$"2017.03.", T.huss.mon1$"2017.04.", T.huss.mon1$"2017.05.", T.huss.mon1$"2017.06.", T.huss.mon1$"2017.07.", T.huss.mon1$"2017.08.", T.huss.mon1$"2017.09.", T.huss.mon1$"2017.10.", T.huss.mon1$"2017.11.", T.huss.mon1$"2017.12.")

#2018
stackedH_18 <- c(T.huss.mon1$"2018.01.", T.huss.mon1$"2018.02.", T.huss.mon1$"2018.03.", T.huss.mon1$"2018.04.", T.huss.mon1$"2018.05.", T.huss.mon1$"2018.06.", T.huss.mon1$"2018.07.", T.huss.mon1$"2018.08.", T.huss.mon1$"2018.09.", T.huss.mon1$"2018.10.", T.huss.mon1$"2018.11.", T.huss.mon1$"2018.12.")

#2019
stackedH_19 <- c(T.huss.mon1$"2019.01.", T.huss.mon1$"2019.02.", T.huss.mon1$"2019.03.", T.huss.mon1$"2019.04.", T.huss.mon1$"2019.05.", T.huss.mon1$"2019.06.", T.huss.mon1$"2019.07.", T.huss.mon1$"2019.08.", T.huss.mon1$"2019.09.", T.huss.mon1$"2019.10.", T.huss.mon1$"2019.11.", T.huss.mon1$"2019.12.")

#2020
stackedH_20 <- c(T.huss.mon1$"2020.01.", T.huss.mon1$"2020.02.", T.huss.mon1$"2020.03.", T.huss.mon1$"2020.04.", T.huss.mon1$"2020.05.", T.huss.mon1$"2020.06.", T.huss.mon1$"2020.07.", T.huss.mon1$"2020.08.", T.huss.mon1$"2020.09.", T.huss.mon1$"2020.10.", T.huss.mon1$"2020.11.", T.huss.mon1$"2020.12.")

#let's stack all the years atop of each other 
stackedH_years <- c(stackedH_06, stackedH_07, stackedH_08, stackedH_09, stackedH_10, stackedH_11, stackedH_12, stackedH_13, stackedH_14, stackedH_15, stackedH_16, stackedH_17, stackedH_18, stackedH_19, stackedH_20)
```

Finally we can add these to the longformat data frame as well and save the data frame in the repository.

```{r}
#add the humidity data 
dengue_longformat$Humidity <- stackedH_years

#save the file in the repository 
filePath = paste(dirname(getwd()), "Correlation_hypothesis", "den_hum_longformat.csv",sep = "/")
write.csv(dengue_longformat, filePath)
```

## 4. Dengue Data frame that does not contain NA's

This normalized data frame might be useful for other observations where NA's might distort the results.
This method of replacing is just an educated guess which is constructed as followed:

1\.
For Provinces that are missing entire years and do not have a total per year given, the values from January to December for each year are replaced by the mean cases of each month during the year.

2\.
The new total then has to be calculated and added to the total cases column of the year and respective province.

3\.
For Provinces where only some variables are missing and the total per year is given, we might try a different approach.

3.1 Firstly we need to calculate a data frame with the percentages of the cases in each month in comparison to the total cases per year.
For example the percentage of cases in January 2018 in the Amnat Charoen Province is calculated by dividing the cases of January 2006 by the total cases of 2006.

3.2 Secondly we need to calculate the mean of these percentages for each month.
If we take the example of January 2006 again this means adding up all percentages in the January 2006 and dividing them by the number of values that where added up.

3.3 Lastly the single NA's are replaced by the percentage average of the respective month in the respective year multiplied by the total cases of the year.
Again for example if the Amnat Charoen Province is missing a value for January 2006, one would multiply the mean of the January 2006 percentage as described in step 3.2 with the total cases in Amnat Charoen in 2006.

I am aware that this process might still not match the actual cases exactly but it is a good attempt to minimize the effects of NA's on different tests and clusters.
Another possibility would have been to replace the NA's through random values in a matching distribution.

### 4.1 Step 1 and 2

```{r}
#make a copy of the dengue_data_com2 dataframe 
dengue_wo_NAs = data.frame(dengue)

#Provinces that are missing entire years are the Bungkan province from 2006-2010 and the Kalasin province form 2008-2009 and 2011-2013. For these provinces the step described in 1. will be applied 

##the province Bungkan is in row number 4  and December 2010 is in column 67
##Kalasin is in row 14, total 2008 to december 2009 are in columns 29 til 54, and total 2011 to december 2013 are in the columns 68 til 106

# loops over all years in dengue dataframe
for(i in 2006 : 2013) {
  
  # loops over total and monthly columns of each year
  for(j in 1:12) {
    # calculates index of corresponding monthly cases
    # cases start at column index 3
    # every year is displayed over 13 columns, thus every year cursor jumps by 13 columns (i-3)*13
    # as years each are displayed in 13 columns, each month the cursor jumps over by 1
    case_index = 3 + (i-2006)*13 + j
    
    selected_cases = dengue_wo_NAs[,case_index]
    #calculate the mean of each month of each year
    mean_cases = mean(selected_cases, na.rm = TRUE)

    #replace the missing values with the means just calculated for the specific provinces and years listed above
    if(i >= 2006 && i <= 2011) {
      dengue_wo_NAs[4,case_index] = mean_cases
    }

    if((i >= 2008 && i <= 2009) || (i >= 2011 && i <= 2013)) {
      dengue_wo_NAs[14,case_index] = mean_cases
    }
    
    if (j == 12) {
      # after multiplying the definition of the arithmetic mean by the number of elements over which the
      # mean is calculated, one finds the sum of number of cases --> easier than using a dedicated sum
      # function ; )
      lower_bound = case_index - 11
      
      if(is.na(dengue_wo_NAs[4,case_index-j])) {
        yearly_total = mean(as.numeric(dengue_wo_NAs[4,lower_bound:case_index]))*12
        dengue_wo_NAs[4,case_index-j] = yearly_total
      }
      if(is.na(dengue_wo_NAs[14,case_index-j])) {
        yearly_total = mean(as.numeric(dengue_wo_NAs[14,lower_bound:case_index]))*12
        dengue_wo_NAs[14,case_index-j] = yearly_total
      }
    }
    
  }
  
}

```

### 4.2 Step 3 Step 3.1

```{r}
#make percentage dataframe
dengue_percentages = data.frame(dengue)


for(i in 2006 : 2020) {
  
  total_index = 3 + (i-2006)*13
  
  # loops over total and monthly columns of each year
  for(j in 0:12) {
    
    month_index = 3 + (i-2006)*13 + j
    
    dengue_percentages[,month_index] = dengue_wo_NAs[,month_index] / dengue_wo_NAs[,total_index]
    
  }
  
}
```

### 4.3 Step 3.2 and 3.3

```{r}
# loops over all years in dengue dataframe without NAs 
for(i in 2006 : 2020) {

total_index = 3 + (i-2006)*13
total_cases = dengue_wo_NAs[,total_index]

# loops over total and monthly columns of each year
  for(j in 1:12) {
    
    month_index = 3 + (i-2006)*13 + j
    column_mean_percent = mean(dengue_percentages[,month_index], na.rm = TRUE)
    replacement_value = column_mean_percent * total_cases
    
    dengue_wo_NAs[, month_index] <- ifelse(is.na(dengue_wo_NAs[, month_index]), replacement_value, dengue_wo_NAs[, month_index])
      
  }

}
  
#save as csv file 
filePath = paste(dirname(getwd()), "dengue_data", "dengue_without_NAs.csv",sep = "/")
write.csv(dengue_wo_NAs, filePath)


#Through replacing the NA's with mean values, the total values might differ a little bit. However as these might be needed in further analysis, I would rather not distort these actual recorded case numbers
```

## 5. Normalized data frame without NA's

Again this data frame needs to be normalized with the population data.

```{r}
#create a new dataframe, where the normalized data will be saved 
dengue_wo_NA_norm = data.frame(dengue_wo_NAs)

# loops over all years in population dataframe
for(i in 3 : ncol(popu_06_20)) {
  # stores yearly population in local variable
  yearly_pop = popu_06_20[,i]
  # loops over total and monthly columns of each year
  for(j in 0:12) {
    # calculates index of corresponding monthly cases
    # cases start at column index 3
    # every year is displayed over 13 columns, thus every year cursor jumps by 13 columns (i-3)*13
    # as years each are displayed in 13 columns, each month the cursor jumps over by 1
    case_index = 3 + (i-3)*13 + j
    
    selected_cases = dengue_wo_NA_norm[,case_index]
    normalized_cases = selected_cases / yearly_pop * 100000
    
    dengue_wo_NA_norm[,case_index] = normalized_cases
  }
}

dengue_wo_NA_norm[sapply(dengue_wo_NA_norm, is.infinite)] <- NA

#let's save the normalized data in the repository 
filePath = paste(dirname(getwd()), "dengue_data", "dengue_without_NAs_norm.csv",sep = "/")
write.csv(dengue_wo_NA_norm, filePath)
```

## 6. Monsoon season Data Frames

### 6.1 Normalized Dengue Data Frame sorted into Monsoon Seasons

As Thailand is strongly influenced by its monsoon seasons, we sort the dengue cases and humidity data into 4 different monsoon seasons.
The inter-monsoon season months are December, January and February, the pre-monsoon seasons are March, April and May, the monsoon seasons are June, July, August and September and finally the post-monsoon seasons are October and November.
The Dengue monsoon seasons will be calculated by using the mean of the respective months.

```{r}
## means of the inter-monsoon seasons over the years 
intermon_06_mean <- rowMeans(dengue_norm[, c( "X2006.01","X2006.02")])
intermon_07_mean <- rowMeans(dengue_norm[, c( "X2006.12", "X2007.01", "X2007.02")])
intermon_08_mean <- rowMeans(dengue_norm[, c( "X2007.12", "X2008.01", "X2008.02")])
intermon_09_mean <- rowMeans(dengue_norm[, c( "X2008.12", "X2009.01", "X2009.02")])
intermon_10_mean <- rowMeans(dengue_norm[, c( "X2009.12", "X2010.01", "X2010.02")])
intermon_11_mean <- rowMeans(dengue_norm[, c( "X2010.12", "X2011.01", "X2011.02")])
intermon_12_mean <- rowMeans(dengue_norm[, c( "X2011.12", "X2012.01", "X2012.02")])
intermon_13_mean <- rowMeans(dengue_norm[, c( "X2012.12", "X2013.01", "X2013.02")])
intermon_14_mean <- rowMeans(dengue_norm[, c( "X2013.12", "X2014.01", "X2014.02")])
intermon_15_mean <- rowMeans(dengue_norm[, c( "X2014.12", "X2015.01", "X2015.02")])
intermon_16_mean <- rowMeans(dengue_norm[, c( "X2015.12", "X2016.01", "X2016.02")])
intermon_17_mean <- rowMeans(dengue_norm[, c( "X2016.12", "X2017.01", "X2017.02")])
intermon_18_mean <- rowMeans(dengue_norm[, c( "X2017.12", "X2018.01", "X2018.02")])
intermon_19_mean <- rowMeans(dengue_norm[, c( "X2018.12", "X2019.01", "X2019.02")])
intermon_20_mean <- rowMeans(dengue_norm[, c( "X2019.12", "X2020.01", "X2020.02")])

##means of the pre-monsoon seasons over the years 
premon_06_mean <- rowMeans(dengue_norm[, c( "X2006.03", "X2006.04", "X2006.05")])
premon_07_mean <- rowMeans(dengue_norm[, c( "X2007.03", "X2007.04", "X2007.05")])
premon_08_mean <- rowMeans(dengue_norm[, c( "X2008.03", "X2008.04", "X2008.05")])
premon_09_mean <- rowMeans(dengue_norm[, c( "X2009.03", "X2009.04", "X2009.05")])
premon_10_mean <- rowMeans(dengue_norm[, c( "X2010.03", "X2010.04", "X2010.05")])
premon_11_mean <- rowMeans(dengue_norm[, c( "X2011.03", "X2011.04", "X2011.05")])
premon_12_mean <- rowMeans(dengue_norm[, c( "X2012.03", "X2012.04", "X2012.05")])
premon_13_mean <- rowMeans(dengue_norm[, c( "X2013.03", "X2013.04", "X2013.05")])
premon_14_mean <- rowMeans(dengue_norm[, c( "X2014.03", "X2014.04", "X2014.05")])
premon_15_mean <- rowMeans(dengue_norm[, c( "X2015.03", "X2015.04", "X2015.05")])
premon_16_mean <- rowMeans(dengue_norm[, c( "X2016.03", "X2016.04", "X2016.05")])
premon_17_mean <- rowMeans(dengue_norm[, c( "X2017.03", "X2017.04", "X2017.05")])
premon_18_mean <- rowMeans(dengue_norm[, c( "X2018.03", "X2018.04", "X2018.05")])
premon_19_mean <- rowMeans(dengue_norm[, c( "X2019.03", "X2019.04", "X2019.05")])
premon_20_mean <- rowMeans(dengue_norm[, c( "X2020.03", "X2020.04", "X2020.05")])

##means of the monsoon seasons over the years 
mon_06_mean <- rowMeans(dengue_norm[, c( "X2006.06", "X2006.07", "X2006.08", "X2006.09")])
mon_07_mean <- rowMeans(dengue_norm[, c( "X2007.06", "X2007.07", "X2007.08", "X2007.09")])
mon_08_mean <- rowMeans(dengue_norm[, c( "X2008.06", "X2008.07", "X2008.08", "X2008.09")])
mon_09_mean <- rowMeans(dengue_norm[, c( "X2009.06", "X2009.07", "X2009.08", "X2009.09")])
mon_10_mean <- rowMeans(dengue_norm[, c( "X2010.06", "X2010.07", "X2010.08", "X2010.09")])
mon_11_mean <- rowMeans(dengue_norm[, c( "X2011.06", "X2011.07", "X2011.08", "X2011.09")])
mon_12_mean <- rowMeans(dengue_norm[, c( "X2012.06", "X2012.07", "X2012.08", "X2012.09")])
mon_13_mean <- rowMeans(dengue_norm[, c( "X2013.06", "X2013.07", "X2013.08", "X2013.09")])
mon_14_mean <- rowMeans(dengue_norm[, c( "X2014.06", "X2014.07", "X2014.08", "X2014.09")])
mon_15_mean <- rowMeans(dengue_norm[, c( "X2015.06", "X2015.07", "X2015.08", "X2015.09")])
mon_16_mean <- rowMeans(dengue_norm[, c( "X2016.06", "X2016.07", "X2016.08", "X2016.09")])
mon_17_mean <- rowMeans(dengue_norm[, c( "X2017.06", "X2017.07", "X2017.08", "X2017.09")])
mon_18_mean <- rowMeans(dengue_norm[, c( "X2018.06", "X2018.07", "X2018.08", "X2018.09")])
mon_19_mean <- rowMeans(dengue_norm[, c( "X2019.06", "X2019.07", "X2019.08", "X2019.09")])
mon_20_mean <- rowMeans(dengue_norm[, c( "X2020.06", "X2020.07", "X2020.08", "X2020.09")])

##means of the post-monsoon seasons over the years
postmon_06_mean <- rowMeans(dengue_norm[, c( "X2006.10", "X2006.11")])
postmon_07_mean <- rowMeans(dengue_norm[, c( "X2007.10", "X2007.11")])
postmon_08_mean <- rowMeans(dengue_norm[, c( "X2008.10", "X2008.11")])
postmon_09_mean <- rowMeans(dengue_norm[, c( "X2009.10", "X2009.11")])
postmon_10_mean <- rowMeans(dengue_norm[, c( "X2010.10", "X2010.11")])
postmon_11_mean <- rowMeans(dengue_norm[, c( "X2011.10", "X2011.11")])
postmon_12_mean <- rowMeans(dengue_norm[, c( "X2012.10", "X2012.11")])
postmon_13_mean <- rowMeans(dengue_norm[, c( "X2013.10", "X2013.11")])
postmon_14_mean <- rowMeans(dengue_norm[, c( "X2014.10", "X2014.11")])
postmon_15_mean <- rowMeans(dengue_norm[, c( "X2015.10", "X2015.11")])
postmon_16_mean <- rowMeans(dengue_norm[, c( "X2016.10", "X2016.11")])
postmon_17_mean <- rowMeans(dengue_norm[, c( "X2017.10", "X2017.11")])
postmon_18_mean <- rowMeans(dengue_norm[, c( "X2018.10", "X2018.11")])
postmon_19_mean <- rowMeans(dengue_norm[, c( "X2019.10", "X2019.11")])
postmon_20_mean <- rowMeans(dengue_norm[, c( "X2020.10", "X2020.11")])
```

let's combine all these vectors into a dataframe

```{r}
#we need the provinces 
Provinces <- dengue_norm$Reporting.areas

#let's save them all in a new dataframe 
dengue_mon_mean <- cbind(Provinces, intermon_06_mean, premon_06_mean, mon_06_mean, postmon_06_mean,intermon_07_mean, premon_07_mean, mon_07_mean, postmon_07_mean,  intermon_08_mean, premon_08_mean, mon_08_mean, postmon_08_mean, intermon_09_mean, premon_09_mean, mon_09_mean, postmon_09_mean, intermon_10_mean, premon_10_mean, mon_10_mean, postmon_10_mean, intermon_11_mean, premon_11_mean, mon_11_mean, postmon_11_mean, intermon_12_mean, premon_12_mean, mon_12_mean, postmon_12_mean, intermon_13_mean, premon_13_mean, mon_13_mean, postmon_13_mean, intermon_14_mean, premon_14_mean, mon_14_mean, postmon_14_mean, intermon_15_mean, premon_15_mean, mon_15_mean, postmon_15_mean, intermon_16_mean, premon_16_mean, mon_16_mean, postmon_16_mean, intermon_17_mean, premon_17_mean, mon_17_mean, postmon_17_mean, intermon_18_mean, premon_18_mean, mon_18_mean, postmon_18_mean, intermon_19_mean, premon_19_mean, mon_19_mean, postmon_19_mean, intermon_20_mean, premon_20_mean, mon_20_mean, postmon_20_mean)

#turn it into a dataframe
dengue_mon_mean <- as.data.frame(dengue_mon_mean)

#turn the character columns into numeric values 
numColumns1 <- names(dengue_mon_mean)[-which(names(dengue_mon_mean) == "Provinces")]
dengue_mon_mean[numColumns1] <- lapply(dengue_mon_mean[numColumns1], as.numeric)
str(dengue_mon_mean)

#let's save yet another dataframe here 
filePath = paste(dirname(getwd()), "dengue_data", "dengue_mon_mean.csv",sep = "/")
write.csv(dengue_mon_mean, filePath)
```

### 6.2 Humidity Data Frame sorted into Monsoon Seasons

We need another dataframe with the means of the humidity during each monsoon season to be able to calculate the correlation between the two, so let's do that.
We will use the mean here as well.

```{r}
#first let's calculate the mean of the intermonsoon seasons 
intermonH_06 <- rowMeans(T.huss.mon1[,c("2006.01.", "2006.02.")])
intermonH_07 <- rowMeans(T.huss.mon1[,c("2006.12.", "2007.01.", "2007.02.")])
intermonH_08 <- rowMeans(T.huss.mon1[,c("2007.12.", "2008.01.", "2008.02.")])
intermonH_09 <- rowMeans(T.huss.mon1[,c("2008.12.", "2009.01.", "2009.02.")])
intermonH_10 <- rowMeans(T.huss.mon1[,c("2009.12.", "2010.01.", "2010.02.")])
intermonH_11 <- rowMeans(T.huss.mon1[,c("2010.12.", "2011.01.", "2011.02.")])
intermonH_12 <- rowMeans(T.huss.mon1[,c("2011.12.", "2012.01.", "2012.02.")])
intermonH_13 <- rowMeans(T.huss.mon1[,c("2012.12.", "2013.01.", "2013.02.")])
intermonH_14 <- rowMeans(T.huss.mon1[,c("2013.12.", "2014.01.", "2014.02.")])
intermonH_15 <- rowMeans(T.huss.mon1[,c("2014.12.", "2015.01.", "2015.02.")])
intermonH_16 <- rowMeans(T.huss.mon1[,c("2015.12.", "2016.01.", "2016.02.")])
intermonH_17 <- rowMeans(T.huss.mon1[,c("2016.12.", "2017.01.", "2017.02.")])
intermonH_18 <- rowMeans(T.huss.mon1[,c("2017.12.", "2018.01.", "2018.02.")])
intermonH_19 <- rowMeans(T.huss.mon1[,c("2018.12.", "2019.01.", "2019.02.")])
intermonH_20 <- rowMeans(T.huss.mon1[,c("2019.12.", "2020.01.", "2020.02.")])

#Do the same for the pre-monsoon months
premonH_06 <- rowMeans(T.huss.mon1[,c("2006.03.", "2006.04.", "2006.05.")])
premonH_07 <- rowMeans(T.huss.mon1[,c("2007.03.", "2007.04.", "2007.05.")])
premonH_08 <- rowMeans(T.huss.mon1[,c("2008.03.", "2008.04.", "2008.05.")])
premonH_09 <- rowMeans(T.huss.mon1[,c("2009.03.", "2009.04.", "2009.05.")])
premonH_10 <- rowMeans(T.huss.mon1[,c("2010.03.", "2010.04.", "2010.05.")])
premonH_11 <- rowMeans(T.huss.mon1[,c("2011.03.", "2011.04.", "2011.05.")])
premonH_12 <- rowMeans(T.huss.mon1[,c("2012.03.", "2012.04.", "2012.05.")])
premonH_13 <- rowMeans(T.huss.mon1[,c("2013.03.", "2013.04.", "2013.05.")])
premonH_14 <- rowMeans(T.huss.mon1[,c("2014.03.", "2014.04.", "2014.05.")])
premonH_15 <- rowMeans(T.huss.mon1[,c("2015.03.", "2015.04.", "2015.05.")])
premonH_16 <- rowMeans(T.huss.mon1[,c("2016.03.", "2016.04.", "2016.05.")])
premonH_17 <- rowMeans(T.huss.mon1[,c("2017.03.", "2017.04.", "2017.05.")])
premonH_18 <- rowMeans(T.huss.mon1[,c("2018.03.", "2018.04.", "2018.05.")])
premonH_19 <- rowMeans(T.huss.mon1[,c("2019.03.", "2019.04.", "2019.05.")])
premonH_20 <- rowMeans(T.huss.mon1[,c("2020.03.", "2020.04.", "2020.05.")])

#again for the monsoon months
monH_06 <- rowMeans(T.huss.mon1[,c("2006.06.", "2006.07.", "2006.08.", "2006.09.")])
monH_07 <- rowMeans(T.huss.mon1[,c("2007.06.", "2007.07.", "2007.08.", "2007.09.")])
monH_08 <- rowMeans(T.huss.mon1[,c("2008.06.", "2008.07.", "2008.08.", "2008.09.")])
monH_09 <- rowMeans(T.huss.mon1[,c("2009.06.", "2009.07.", "2009.08.", "2009.09.")])
monH_10 <- rowMeans(T.huss.mon1[,c("2010.06.", "2010.07.", "2010.08.", "2010.09.")])
monH_11 <- rowMeans(T.huss.mon1[,c("2011.06.", "2011.07.", "2011.08.", "2011.09.")])
monH_12 <- rowMeans(T.huss.mon1[,c("2012.06.", "2012.07.", "2012.08.", "2012.09.")])
monH_13 <- rowMeans(T.huss.mon1[,c("2013.06.", "2013.07.", "2013.08.", "2013.09.")])
monH_14 <- rowMeans(T.huss.mon1[,c("2014.06.", "2014.07.", "2014.08.", "2014.09.")])
monH_15 <- rowMeans(T.huss.mon1[,c("2015.06.", "2015.07.", "2015.08.", "2015.09.")])
monH_16 <- rowMeans(T.huss.mon1[,c("2016.06.", "2016.07.", "2016.08.", "2016.09.")])
monH_17 <- rowMeans(T.huss.mon1[,c("2017.06.", "2017.07.", "2017.08.", "2017.09.")])
monH_18 <- rowMeans(T.huss.mon1[,c("2018.06.", "2018.07.", "2018.08.", "2018.09.")])
monH_19 <- rowMeans(T.huss.mon1[,c("2019.06.", "2019.07.", "2019.08.", "2019.09.")])
monH_20 <- rowMeans(T.huss.mon1[,c("2020.06.", "2020.07.", "2020.08.", "2020.09.")])

#again for the postmonsoon seasons
postmonH_06 <- rowMeans(T.huss.mon1[,c("2006.10.", "2006.11.")])
postmonH_07 <- rowMeans(T.huss.mon1[,c("2007.10.", "2007.11.")])
postmonH_08 <- rowMeans(T.huss.mon1[,c("2008.10.", "2008.11.")])
postmonH_09 <- rowMeans(T.huss.mon1[,c("2009.10.", "2009.11.")])
postmonH_10 <- rowMeans(T.huss.mon1[,c("2010.10.", "2010.11.")])
postmonH_11 <- rowMeans(T.huss.mon1[,c("2011.10.", "2011.11.")])
postmonH_12 <- rowMeans(T.huss.mon1[,c("2012.10.", "2012.11.")])
postmonH_13 <- rowMeans(T.huss.mon1[,c("2013.10.", "2013.11.")])
postmonH_14 <- rowMeans(T.huss.mon1[,c("2014.10.", "2014.11.")])
postmonH_15 <- rowMeans(T.huss.mon1[,c("2015.10.", "2015.11.")])
postmonH_16 <- rowMeans(T.huss.mon1[,c("2016.10.", "2016.11.")])
postmonH_17 <- rowMeans(T.huss.mon1[,c("2017.10.", "2017.11.")])
postmonH_18 <- rowMeans(T.huss.mon1[,c("2018.10.", "2018.11.")])
postmonH_19 <- rowMeans(T.huss.mon1[,c("2019.10.", "2019.11.")])
postmonH_20 <- rowMeans(T.huss.mon1[,c("2020.10.", "2020.11.")])

#put all the means together in a new dataframe
humidity_mon <- cbind(Provinces, intermonH_06, premonH_06, monH_06, postmonH_06, intermonH_07, premonH_07, monH_07, postmonH_07, intermonH_08, premonH_08, monH_08, postmonH_08, intermonH_09, premonH_09, monH_09, postmonH_09, intermonH_10, premonH_10, monH_10, postmonH_10, intermonH_11, premonH_11, monH_11, postmonH_11, intermonH_12, premonH_12, monH_12, postmonH_12, intermonH_13, premonH_13, monH_13, postmonH_13, intermonH_14, premonH_14, monH_14, postmonH_14, intermonH_15, premonH_15, monH_15, postmonH_15, intermonH_16, premonH_16, monH_16, postmonH_16, intermonH_17, premonH_17, monH_17, postmonH_17, intermonH_18, premonH_18, monH_18, postmonH_18, intermonH_19, premonH_19, monH_19, postmonH_19, intermonH_20, premonH_20, monH_20, postmonH_20)

#turn it into a dataframe
humidity_mon <- as.data.frame(humidity_mon)

#save the dataframe 
filePath = paste(dirname(getwd()), "geo_data", "humidity_mon.csv",sep = "/")
write.csv(humidity_mon, filePath)
```

## 7. Yearly stacked Monsoon Season Data Frame with both Humidity and Dengue cases longformat

Let's try a long format, so that the monsoon seasons of each year are stacked atop of each other of every year with one column for the dengue cases and one column for the humidity data.

```{r}
# Create an empty vector to store the stacked seasons
stacked_seasonsD <- c()

# List of year range from 2006 to 2020
years <- 06:20

# List of season prefixes
season_prefixes <- c("intermon", "premon", "mon", "postmon")

# Nested loops to stack each season for each year
for (year in years) {
  for (season_prefix in season_prefixes) {
    # Create the variable name dynamically
    variable_name <- paste0(season_prefix, "_", formatC(year, width = 2, flag = "0"), "_mean")
    
    # Get the value of the variable using get()
    season_mean <- get(variable_name)
    
    # Append the season_mean to the stacked_seasonsD vector
    stacked_seasonsD <- c(stacked_seasonsD, season_mean)
  }
}

```

Do the same steps again for the humidity data.

```{r}
# Create an empty vector to store the stacked humidity data
stacked_seasonsH <- c()

# List of year range from 2006 to 2020
years <- 06:20

# List of humidity season prefixes
humidity_season_prefixes <- c("intermonH", "premonH", "monH", "postmonH")

# Nested loops to stack each humidity season for each year
for (year in years) {
  for (humidity_season_prefix in humidity_season_prefixes) {
    # Create the variable name dynamically
    variable_name <- paste0(humidity_season_prefix, "_", formatC(year, width = 2, flag = "0"))
    
    # Get the value of the variable using get()
    humidity_data <- get(variable_name)
    
    # Append the humidity_data to the stacked_seasonsH vector
    stacked_seasonsH <- c(stacked_seasonsH, humidity_data)
  }
}

```

These are just giant vectors now.
To be able to work with them they need to be combined into a data frame.

```{r}
# Create a dataframe by combining the two vectors
monsoon_longformat <- data.frame(Dengue = stacked_seasonsD, Humidity = stacked_seasonsH)

years <- rep(2006:2020, each = 4 * 77)  # Repeat each year 4 seasons * 77 provinces times
seasons <- rep(rep(c("intermon", "premon", "mon", "postmon"), each = 77), times = 15)  # Repeat each season 77 provinces * 15 years times

# Repeat the province names to match the length of the combined_dataframe
province_names <- rep(Provinces, length.out = nrow(monsoon_longformat))


# Add the Provinces, the years and seasons to the dataframe
monsoon_longformat$Year <- years
monsoon_longformat$Season <- seasons
monsoon_longformat$Province <- province_names

#now we just need to reorder the dataframe
monsoon_longformat <- data.frame(Province = province_names, Year = years, Season = seasons, Dengue = stacked_seasonsD, Humidity = stacked_seasonsH)
```

let's save this data frame in the repository.

```{r}
#save the dataframe 
filePath = paste(dirname(getwd()), "Correlation_hypothesis", "monsoon_longformat.csv",sep = "/")
write.csv(monsoon_longformat, filePath)
```

### 7.1 Wide-format of the Monsoon seasons Dengue cases and humidity.

This is the same data but in the wideformat.

let's just quickly stack them atop each other

```{r}
##let's stack the data for the years atop of each other for easier calculation with the cor() function 

#start with the inter-monsoon dengue cases
stacked_intermon_mean <- c(intermon_06_mean, intermon_07_mean, intermon_08_mean, intermon_09_mean, intermon_10_mean, intermon_11_mean, intermon_12_mean, intermon_13_mean, intermon_14_mean, intermon_15_mean, intermon_16_mean, intermon_17_mean, intermon_18_mean, intermon_19_mean, intermon_20_mean)

#next pre-monsoon dengue cases 
stacked_premon_mean <- c(premon_06_mean, premon_07_mean, premon_08_mean, premon_09_mean, premon_10_mean, premon_11_mean, premon_12_mean, premon_13_mean, premon_14_mean, premon_15_mean, premon_16_mean, premon_17_mean, premon_18_mean, premon_19_mean, premon_20_mean)

#next monsoon dengue cases 
stacked_mon_mean <- c(mon_06_mean, mon_07_mean, mon_08_mean, mon_09_mean, mon_10_mean, mon_11_mean, mon_12_mean, mon_13_mean, mon_14_mean, mon_15_mean, mon_16_mean, mon_17_mean, mon_18_mean, mon_19_mean, mon_20_mean)

#next post-monsoon dengue cases 
stacked_postmon_mean <- c(postmon_06_mean, postmon_07_mean, postmon_08_mean, postmon_09_mean, postmon_10_mean, postmon_11_mean, postmon_12_mean, postmon_13_mean, postmon_14_mean, postmon_15_mean, postmon_16_mean, postmon_17_mean, postmon_18_mean, postmon_19_mean, postmon_20_mean)

##let's do the same for the humidity monsoon seasons 
#inter-monsoon seasons 
stacked_intermonH <- c(intermonH_06, intermonH_07, intermonH_08, intermonH_09, intermonH_10, intermonH_11, intermonH_12, intermonH_13, intermonH_14, intermonH_15, intermonH_16, intermonH_17, intermonH_18, intermonH_19, intermonH_20)

#pre-monsoon seasons
stacked_premonH <- c(premonH_06, premonH_07, premonH_08, premonH_09, premonH_10, premonH_11, premonH_12, premonH_13, premonH_14, premonH_15, premonH_16, premonH_17, premonH_18, premonH_19, premonH_20)

#monsoon seasons 
stacked_monH <-c(monH_06, monH_07, monH_08, monH_09, monH_10, monH_11, monH_12, monH_13, monH_14, monH_15, monH_16, monH_17, monH_18, monH_19, monH_20)

#post-monsoon seasons 
stacked_postmonH <- c(postmonH_06, postmonH_07, postmonH_08, postmonH_09, postmonH_10, postmonH_11, postmonH_12, postmonH_13, postmonH_14, postmonH_15, postmonH_16, postmonH_17, postmonH_18, postmonH_19, postmonH_20)

#we need the provinces in the stacked dataframe too
Provinces 

#and a column with the years 
years <- rep(2006:2020, each = 77)

#stack them 15 times 
stacked_provinces <- rep(Provinces, times = 15)

#make another dataframe to calculate the correlation 
stacked_monsoon_mean <- cbind(Year = years,Provinces = stacked_provinces, intermon = stacked_intermon_mean, intermonH = stacked_intermonH, premon = stacked_premon_mean, premonH = stacked_premonH, mon = stacked_mon_mean, monH = stacked_monH, postmon = stacked_postmon_mean, postmonH = stacked_postmonH)

#turn it into a dataframe
stacked_monsoon_mean <- as.data.frame(stacked_monsoon_mean)

#turn the character columns into numeric values 
numColumns1 <- names(stacked_monsoon_mean)[-which(names(stacked_monsoon_mean) == "Provinces")]
stacked_monsoon_mean[numColumns1] <- lapply(stacked_monsoon_mean[numColumns1], as.numeric)
str(stacked_monsoon_mean)
```

Let's save this data frame in the repository to avoid having to run all this code just to use the data frame.

```{r}
filePath = paste(dirname(getwd()), "Correlation_hypothesis", "stacked_monsoon_seasons_mean.csv",sep = "/")
write.csv(stacked_monsoon_mean, filePath)
```

## 8. Total dengue cases and population density stacked

To calculate the correlation between the total dengue cases and the population density we need the total dengue cases stacked atop of each other and the population density as well.
The population density is in population per square kilometer.

```{r}
#stack the total dengue cases per year atop of each other from the normalized dengue cases 
stacked_totalD <- c(dengue_norm$X2006.total, dengue_norm$X2007.total, dengue_norm$X2008.total, dengue_norm$X2008.total, dengue_norm$X2009.total, dengue_norm$X2010.total, dengue_norm$X2011.total, dengue_norm$X2012.total, dengue_norm$X2013.total, dengue_norm$X2014.total, dengue_norm$X2015.total, dengue_norm$X2016.total, dengue_norm$X2017.total, dengue_norm$X2018.total, dengue_norm$X2019.total, dengue_norm$X2020.total)

#stack the population density atop of each other 
stacked_popu_density <- c(popu_density$"2006", popu_density$"2007", popu_density$"2008", popu_density$"2009", popu_density$"2010", popu_density$"2011", popu_density$"2012", popu_density$"2013", popu_density$"2014", popu_density$"2015", popu_density$"2016", popu_density$"2017", popu_density$"2018", popu_density$"2019", popu_density$"2020")

#we need the provinces in the stacked dataframe too
Provinces 
#stack them 15 times 
stacked_provinces <- rep(Provinces, times = 15)

#and a column with the years 
years <- rep(2006:2020, each = 77)

#let's add the mean of the humidity values for each year and each province as well just for good measure 
##first calculate the means for each year 
meanH_06 <- rowMeans(T.huss.mon1[,c("2006.01.", "2006.02.", "2006.03.", "2006.04.", "2006.05.", "2006.06.", "2006.07.", "2006.08.", "2006.09.", "2006.10.", "2006.11.", "2006.12.")])
meanH_07 <- rowMeans(T.huss.mon1[,c("2007.01.", "2007.02.", "2007.03.", "2007.04.", "2007.05.", "2007.06.", "2007.07.", "2007.08.", "2007.09.", "2007.10.", "2007.11.", "2007.12.")])
meanH_08 <- rowMeans(T.huss.mon1[,c("2008.01.", "2008.02.", "2008.03.", "2008.04.", "2008.05.", "2008.06.", "2008.07.", "2008.08.", "2008.09.", "2008.10.", "2008.11.", "2008.12.")])
meanH_09 <- rowMeans(T.huss.mon1[,c("2009.01.", "2009.02.", "2009.03.", "2009.04.", "2009.05.", "2009.06.", "2009.07.", "2006.09.", "2009.09.", "2009.10.", "2009.11.", "2009.12.")])
meanH_10 <- rowMeans(T.huss.mon1[,c("2010.01.", "2010.02.", "2010.03.", "2010.04.", "2010.05.", "2010.06.", "2010.07.", "2010.08.", "2010.09.", "2010.10.", "2010.11.", "2010.12.")])
meanH_11 <- rowMeans(T.huss.mon1[,c("2011.01.", "2011.02.", "2011.03.", "2011.04.", "2011.05.", "2011.06.", "2011.07.", "2011.08.", "2011.09.", "2011.10.", "2011.11.", "2011.12.")])
meanH_12 <- rowMeans(T.huss.mon1[,c("2012.01.", "2012.02.", "2012.03.", "2012.04.", "2012.05.", "2012.06.", "2012.07.", "2012.08.", "2012.09.", "2012.10.", "2012.11.", "2012.12.")])
meanH_13 <- rowMeans(T.huss.mon1[,c("2013.01.", "2013.02.", "2013.03.", "2013.04.", "2013.05.", "2013.06.", "2013.07.", "2013.08.", "2013.09.", "2013.10.", "2013.11.", "2013.12.")])
meanH_14 <- rowMeans(T.huss.mon1[,c("2014.01.", "2014.02.", "2014.03.", "2014.04.", "2014.05.", "2014.06.", "2014.07.", "2014.08.", "2014.09.", "2014.10.", "2014.11.", "2014.12.")])
meanH_15 <- rowMeans(T.huss.mon1[,c("2015.01.", "2015.02.", "2015.03.", "2015.04.", "2015.05.", "2015.06.", "2015.07.", "2015.08.", "2015.09.", "2015.10.", "2015.11.", "2015.12.")])
meanH_16 <- rowMeans(T.huss.mon1[,c("2016.01.", "2016.02.", "2016.03.", "2016.04.", "2016.05.", "2016.06.", "2016.07.", "2016.08.", "2016.09.", "2016.10.", "2016.11.", "2016.12.")])
meanH_17 <- rowMeans(T.huss.mon1[,c("2017.01.", "2017.02.", "2017.03.", "2017.04.", "2017.05.", "2017.06.", "2017.07.", "2017.08.", "2017.09.", "2017.10.", "2017.11.", "2017.12.")])
meanH_18 <- rowMeans(T.huss.mon1[,c("2018.01.", "2018.02.", "2018.03.", "2018.04.", "2018.05.", "2018.06.", "2018.07.", "2018.08.", "2018.09.", "2018.10.", "2018.11.", "2018.12.")])
meanH_19 <- rowMeans(T.huss.mon1[,c("2019.01.", "2019.02.", "2019.03.", "2019.04.", "2019.05.", "2019.06.", "2019.07.", "2019.08.", "2019.09.", "2019.10.", "2019.11.", "2019.12.")])
meanH_20 <- rowMeans(T.huss.mon1[,c("2020.01.", "2020.02.", "2020.03.", "2020.04.", "2020.05.", "2020.06.", "2020.07.", "2020.08.", "2020.09.", "2020.10.", "2020.11.", "2020.12.")])

##stack the means atop of each other 
stackedH_mean <- c(meanH_06, meanH_07, meanH_08, meanH_09, meanH_10, meanH_11, meanH_12, meanH_13, meanH_14, meanH_15, meanH_16, meanH_17, meanH_18, meanH_19, meanH_20)

#bind them into a dataframe 
stacked_den_popu_density <- cbind(Provinces = stacked_provinces, Year = years, Dengue = stacked_totalD, Population_density = stacked_popu_density, Humidity = stackedH_mean)
stacked_den_popu_density <- data.frame(stacked_den_popu_density)

#turn the character columns into numeric values 
numColumns1 <- names(stacked_den_popu_density)[-which(names(stacked_den_popu_density) == "Provinces")]
stacked_den_popu_density[numColumns1] <- lapply(stacked_den_popu_density[numColumns1], as.numeric)
str(stacked_den_popu_density)

#let's save it in the repository again 
filePath = paste(dirname(getwd()), "Correlation_hypothesis", "stacked_dengue_population_density_humidity.csv",sep = "/")
write.csv(stacked_den_popu_density, filePath)

```
